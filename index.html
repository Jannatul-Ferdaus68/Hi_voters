<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>ভোটার তথ্য অনুসন্ধান</title>

  <!-- Tailwind -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <style>
    body {
      font-family: "Segoe UI", system-ui, sans-serif;
    }
    mark {
      background-color: #fde68a;
      padding: 0 2px;
      border-radius: 3px;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">

  <div class="max-w-4xl mx-auto p-4">

    <!-- Header -->
    <h1 class="text-2xl font-bold text-center mb-4">
      ভোটার তথ্য অনুসন্ধান
    </h1>

    <!-- Search -->
    <input
      id="searchInput"
      type="text"
      placeholder="নাম লিখুন"
      class="w-full p-3 rounded-lg border mb-4 text-lg bg-white"
    />

    <!-- Info -->
    <p id="infoText" class="text-center text-gray-600 mb-4"></p>

    <!-- Results -->
    <div id="results" class="space-y-4"></div>

    <!-- Pagination -->
    <div id="pagination" class="flex justify-center gap-4 mt-6"></div>

  </div>

<script>
let voters = [];
let filteredVoters = [];
let currentPage = 1;
const perPage = 20;

const searchInput = document.getElementById("searchInput");
const results = document.getElementById("results");
const pagination = document.getElementById("pagination");
const infoText = document.getElementById("infoText");

// Bangla Normalization (Search only)
function normalizeBangla(text) {
  if (!text) return "";

  return text
    .normalize("NFC")
    .replace(/\u200C|\u200D/g, "")
    .replace(/য়/g, "য়")
    .replace(/য/g, "য়")
    .replace(/[া]/g, "")
    .replace(/[িী]/g, "")
    .replace(/[েৈ]/g, "")
    .replace(/[োৌ]/g, "")
    .replace(/\s+/g, "")
    .trim();
}

//Render voters (USES filteredVoters)
function renderVoters() {
  results.innerHTML = "";
  pagination.innerHTML = "";

  if (!filteredVoters.length) {
    results.innerHTML = "<p class='text-center'>কোনো তথ্য পাওয়া যায়নি</p>";
    return;
  }

  const start = (currentPage - 1) * perPage;
  const end = start + perPage;
  const pageItems = filteredVoters.slice(start, end);

  pageItems.forEach(v => {
    const card = document.createElement("div");
    card.className = "bg-white rounded-xl shadow p-4";

    card.innerHTML = `
      <p><strong>নাম:</strong> ${v.name || "-"}</p>
      <p><strong>ভোটার নং:</strong> ${v.voter_id || "-"}</p>
      <p><strong>পিতা:</strong> ${v.father || "-"}</p>
      <p><strong>মাতা:</strong> ${v.mother || "-"}</p>
      <p><strong>পেশা:</strong> ${v.occupation || "-"}</p>
      <p><strong>জন্ম তারিখ:</strong> ${v.date_of_birth || "-"}</p>
      <p><strong>ঠিকানা:</strong> ${v.address || "-"}</p>
    `;

    results.appendChild(card);
  });

  renderPagination();
}

//Pagination
function renderPagination() {
  const totalPages = Math.ceil(filteredVoters.length / perPage);
  if (totalPages <= 1) return;

  if (currentPage > 1) {
    const prev = document.createElement("button");
    prev.textContent = "পূর্ববর্তী";
    prev.className = "px-4 py-2 bg-gray-300 rounded";
    prev.onclick = () => {
      currentPage--;
      renderVoters();
    };
    pagination.appendChild(prev);
  }

  const pageInfo = document.createElement("span");
  pageInfo.textContent = `পৃষ্ঠা ${currentPage} / ${totalPages}`;
  pageInfo.className = "px-3 py-2 text-gray-600";
  pagination.appendChild(pageInfo);

  if (currentPage < totalPages) {
    const next = document.createElement("button");
    next.textContent = "পরবর্তী";
    next.className = "px-4 py-2 bg-gray-300 rounded";
    next.onclick = () => {
      currentPage++;
      renderVoters();
    };
    pagination.appendChild(next);
  }
}

//Load JSON
fetch("voters.json")
  .then(res => res.json())
  .then(data => {
    voters = data;

    //pre-normalize once (PERFORMANCE BOOST)
    voters.forEach(v => {
      v._searchName = normalizeBangla(v.name || "");
    });

    filteredVoters = voters;
    renderVoters();

  });

// Search (NAME ONLY)
let timer;
searchInput.addEventListener("input", () => {
  clearTimeout(timer);

  timer = setTimeout(() => {
    const q = normalizeBangla(searchInput.value);
    currentPage = 1;

    if (!q) {
      filteredVoters = voters;
      renderVoters();
      return;
    }

    filteredVoters = voters.filter(v =>
      v._searchName.includes(q)
    );

    renderVoters();
  }, 300);
});
</script>

</body>
</html>
