<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®</title>

  <!-- Tailwind -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <style>
    body {
      font-family: "Segoe UI", system-ui, sans-serif;
    }
    mark {
      background-color: #fde68a;
      padding: 0 2px;
      border-radius: 3px;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">

  <div class="max-w-4xl mx-auto p-4">

    <!-- Header -->
    <h1 class="text-2xl font-bold text-center mb-4">
      ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®
    </h1>

    <!-- Search -->
    <input
      id="searchInput"
      type="text"
      placeholder="‡¶®‡¶æ‡¶Æ / ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç / ‡¶™‡ßá‡¶∂‡¶æ / ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
      class="w-full p-3 rounded-lg border mb-4 text-lg"
    />

    <!-- Info -->
    <p id="infoText" class="text-center text-gray-600 mb-4"></p>

    <!-- Results -->
    <div id="results" class="space-y-4"></div>

    <!-- Pagination -->
    <div id="pagination" class="flex justify-center gap-4 mt-6"></div>

  </div>

<script>
let voters = [];
let filteredVoters = [];
let currentPage = 1;
const perPage = 20;

const searchInput = document.getElementById("searchInput");
const results = document.getElementById("results");
const pagination = document.getElementById("pagination");
const infoText = document.getElementById("infoText");

// üîπ Highlight Bangla text
function highlight(text, q) {
  if (!text || !q) return text || "-";

  const cleanText = normalizeBangla(text);
  const cleanQ = normalizeBangla(q);

  return cleanText.replaceAll(cleanQ, `<mark>${cleanQ}</mark>`);
}

// üîπ Render voters
function renderVoters() {
  results.innerHTML = "";
  pagination.innerHTML = "";

  if (filteredVoters.length === 0) {
    results.innerHTML = "<p class='text-center'>‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>";
    return;
  }

  const start = (currentPage - 1) * perPage;
  const end = start + perPage;
  const pageItems = filteredVoters.slice(start, end);
  const q = searchInput.value.trim();

  pageItems.forEach(v => {
    const card = document.createElement("div");
    card.className = "bg-white rounded-xl shadow p-4";

    card.innerHTML = `
      <p><strong>‡¶®‡¶æ‡¶Æ:</strong> ${highlight(v.name, q)}</p>
      <p><strong>‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç:</strong> ${v.voter_id || "-"}</p>
      <p><strong>‡¶™‡¶ø‡¶§‡¶æ:</strong> ${v.father || "-"}</p>
      <p><strong>‡¶Æ‡¶æ‡¶§‡¶æ:</strong> ${v.mother || "-"}</p>
      <p><strong>‡¶™‡ßá‡¶∂‡¶æ:</strong> ${v.occupation || "-"}</p>
      <p><strong>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${v.date_of_birth || "-"}</p>
      <p><strong>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</strong> ${v.address || "-"}</p>
    `;

    results.appendChild(card);
  });

  renderPagination();
}

// üîπ Pagination
function renderPagination() {
  const totalPages = Math.ceil(filteredVoters.length / perPage);
  if (totalPages <= 1) return;

  if (currentPage > 1) {
    const prev = document.createElement("button");
    prev.textContent = "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ";
    prev.className = "px-4 py-2 bg-gray-300 rounded";
    prev.onclick = () => {
      currentPage--;
      renderVoters();
    };
    pagination.appendChild(prev);
  }

  const pageInfo = document.createElement("span");
  pageInfo.textContent = `‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ${currentPage} / ${totalPages}`;
  pageInfo.className = "px-3 py-2 text-gray-600";
  pagination.appendChild(pageInfo);

  if (currentPage < totalPages) {
    const next = document.createElement("button");
    next.textContent = "‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ";
    next.className = "px-4 py-2 bg-gray-300 rounded";
    next.onclick = () => {
      currentPage++;
      renderVoters();
    };
    pagination.appendChild(next);
  }
}

// üîπ Load voters.json
fetch("voters.json")
  .then(res => res.json())
  .then(data => {
    voters = data;
    infoText.textContent = "‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
  });

// üîπ Search ONLY by name
searchInput.addEventListener("input", () => {
  const q = searchInput.value.trim();
  currentPage = 1;

  if (q === "") {
    filteredVoters = [];
    results.innerHTML = "";
    pagination.innerHTML = "";
    infoText.textContent = "‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
    return;
  }

  function normalizeBangla(text) {
  return text
    .normalize("NFC")
    .replace(/\u200C|\u200D/g, "") // remove ZWNJ / ZWJ
    .trim();
}

filteredVoters = voters.filter(v => {
  if (!v.name) return false;

  const storedName = normalizeBangla(v.name);
  const typedName = normalizeBangla(q);

  return storedName.includes(typedName);
});


  renderVoters();
});
</script>


</body>
</html>
